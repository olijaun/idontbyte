<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">
    <title>Why Bean Validation is evil and how it could be useful anyway</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-"
          crossorigin="anonymous">

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <!--<![endif]-->


    <!--[if lte IE 8]>
    <link rel="stylesheet" href="css/layouts/blog-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/assets/blog.css">
    <!--<![endif]-->


<!--    <link rel="stylesheet"-->
<!--          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">-->
<!--    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>-->
<!--    <script>hljs.initHighlightingOnLoad();</script>-->

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-50141806-2', 'auto');
        ga('send', 'pageview');

    </script>

</head>


<body>

<div id="layout" class="pure-g">

    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <h1 class="brand-title">I don't byte</h1>
        <h2 class="brand-tagline">Oliver Jaun's Blog On Software Development</h2>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="pure-button" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="/about.html">About</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!-- A single blog post -->
        <section class="post">

            <header class="post-header">

                <h2 class="post-title">Why Bean Validation is evil and how it could be useful anyway</h2>

                <p class="post-meta">
                    By <a class="post-anchor" href="/about">Oliver Jaun</a>,
                    
                    <time datetime='2019-10-10'>Oct 10, 2019</time>
                    

                    


                    
                    <a class="post-category post-category-java" href="#">java</a>
                    
                    <a class="post-category post-category-design" href="#">design</a>
                    
                </p>
            </header>

            <div class="post-description">
                <p>
                    <p>I’ve never really looked at <a href="https://jcp.org/en/jsr/detail?id=380">Java Bean Validation</a>) until some architects at my company suggested it. After going through a tutorial I was not convinced… So I googled for “Bean Validation is bad” in order to see if I’m the only one. And I was not…</p>

<p>However one of the first blog posts that appeared was <a href="https://in.relation.to/2014/06/19/blah-vs-bean-validation-you-missed-the-point-like-mars-climate-orbiter/">this one here</a> written by Emmanual Bernard which was the Spec Lead of Bean Validation. He’s is actually defending Bean Validation in the article which of course is not a surprise.</p>

<p>The guy who confirmed my doubts was a guy named Oliver Gierke (who seems to have a nice blog <a href="http://olivergierke.de">here</a>). His comments on the mentioned blog post were very good and I can agree almost 100% with what he is saying. However this was just a small comment and I think this topic deserves a full blog post. I also found a a way of using Bean Validation in an acceptable way that I would like to share. But let’s start in the beginning.</p>

<h1 id="whats-the-problem">What’s the problem?</h1>

<p>Let’s look at the example Oliver is using in his response to Emmanuel’s post:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	<span class="nd">@NotNull</span> <span class="nd">@Email</span>
	<span class="nc">String</span> <span class="n">emailAddress</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>This assures that the email address cannot be null and that it conforms to some other validation rules defined by <code class="highlighter-rouge">@Email</code>. So if you have e.g. an ejb bean method that accepts a user you have to do the following:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Stateless</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>If you forget @Valid then nothing will be validated. If this would be a method of an unmanaged class (just some class you’re instanciating) then no validation would be performed(regardless of whether you are using <code class="highlighter-rouge">@Valid</code> or not)!</p>

<p>Let’s look at an alternative approach Oliver Gierke is proposing:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">EmailAddress</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="nf">EmailAddress</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
	  <span class="c1">// explicit null check</span>
	  <span class="c1">// regex validation</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
	
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="nc">EmailAddress</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
	  <span class="c1">// reject null email</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>A new class <code class="highlighter-rouge">EmailAddress</code> is introduced. The constructor explicitly validates the value. In other words: the constructor is doing what it was made for:</p>

<blockquote>
  <p>They [constructors] have the task of initializing the object’s data members and of establishing the invariant of the class, failing if the invariant is invalid. <a href="https://en.wikipedia.org/w/index.php?title=Constructor_(object-oriented_programming)&amp;oldid=919933748">Wikipedia</a></p>
</blockquote>

<p>So by using Bean Validation you are basically ignoring essential object oriented principals. So why would anyone invent something like Bean Validation? Emmanual Bernard thinks that developers are lazy:</p>

<blockquote>
  <p>If you do that in your projects kudos. Most developers including me are more lazy :)</p>
</blockquote>

<p>I think it is the opposite: If they were lazy they would define an EmailAddress class. Let’s look at the following code where we use the first version of the User object that contains an email as string:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Stateless</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="n">sendEmail</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmailAddress</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Stateless</span>
<span class="kd">class</span> <span class="nc">EmailSender</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendEmail</span><span class="o">(</span><span class="nd">@Email</span> <span class="nc">String</span> <span class="n">emailAddress</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>The <code class="highlighter-rouge">create</code> method calls <code class="highlighter-rouge">sendEmail</code> in another ejb. Again the email has to be validated because it is just a string. Now imagine how it looks when EmailAddress is a proper object:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Stateless</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// ...</span>
        <span class="n">sendEmail</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getEmailAddress</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Stateless</span>
<span class="kd">class</span> <span class="nc">EmailSender</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendEmail</span><span class="o">(</span><span class="nc">EmailAddress</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Although the difference is not very big, the second version looks simpler to me. Of course, you have to create an extra object. But then you could also implement some behaviour…</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">EmailAddress</span> <span class="n">emailAddress</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EmailAddress</span><span class="o">(</span><span class="s">"james.bond@mi6.co.uk"</span><span class="o">);</span>

<span class="n">emailAddress</span><span class="o">.</span><span class="na">punyEncoded</span><span class="o">();</span> <span class="c1">// returns a punny encoded string</span>
<span class="n">emailAddress</span><span class="o">.</span><span class="na">isGmailAddress</span><span class="o">();</span> <span class="c1">// returns true if email ends with gmail.com or google.com etc.</span>
<span class="n">emailAddress</span><span class="o">.</span><span class="na">getDomainPart</span><span class="o">();</span> <span class="c1">// returns "mi6.co.uk"</span>
<span class="n">emailAddress</span><span class="o">.</span><span class="na">getLocalPart</span><span class="o">();</span> <span class="c1">// returns "james.bond"</span></code></pre></figure>

<p>This is what objects are all about.</p>

<p>It’s amazing how Java developers try to avoid objects. I think the problem comes from the history of Java and frameworks like JEE and JPA that forced people to implement classes with empty constructors. In JPA you are forced to create DTOs which are not Objects but data structures. The “O” in “ORM” stands for Object but what you are doing is mapping data from the database to a data structure. There is <a href="https://blog.cleancoder.com/uncle-bob/2019/06/16/ObjectsAndDataStructures.html">very funny blog post from Robert C. Martin (Uncle Bob)</a> where he writes about it. Don’t miss it.</p>

<p>It’s also very simple to test the User Object containing the EmailAddress object.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">invalid</span><span class="o">()</span> <span class="o">{</span>
    
    <span class="nc">Execution</span> <span class="n">e</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="k">new</span> <span class="nc">EMailAddress</span><span class="o">(</span><span class="s">"invalid@@@@@@email.com"</span><span class="o">));</span>
    
    <span class="n">assertThrows</span><span class="o">(</span><span class="nc">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Pretty simple, right? Now with Bean Validation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
  <span class="nd">@Test</span>
  <span class="kt">void</span> <span class="nf">invalid</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"invalid@@@@@@email.com"</span><span class="o">);</span>
    
    <span class="nc">ValidatorFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>
    <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
    <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConstraintViolation</span><span class="o">&lt;</span><span class="nc">AdditionBean</span><span class="o">&gt;&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>So which test would you prefer as a lazy programmer? Of course I’m exaggerating a bit. As you can see Bean Validation seems to offer something called a ConstraintViolation. The EmailAddress doesn’t have this “out-of-the-box” but it could certainly be implemented although I wouldn’t do it. I’ll explain later why.</p>

<p>Now, after bad-mouthing bean validation let’s talk about it virtues.</p>

<h1 id="the-virtues-of-bean-validation">The virtues of Bean Validation</h1>

<p>Assume the following RESTfull service:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="no">POST</span> <span class="o">/</span><span class="n">registration</span>
<span class="o">{</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"Oliver Jaun"</span><span class="o">,</span>
    <span class="s">"emailAddress"</span><span class="o">:</span> <span class="s">"abc@example.com"</span>
<span class="o">}</span></code></pre></figure>

                </p>
            </div>
        </section>

        


<div id="disqus_thread"></div>
<script>

    var disqus_config = function () {
        this.page.url = "http://idontbyte.jaun.org/blog/2019/10/banvalidation";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "/blog/2019/10/banvalidation"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//idontbyte-jaun-org.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



        

<div class="footer">
    <div class="pure-menu pure-menu-horizontal">
        &copy; 2019 - Oliver Jaun
        <ul>
            <li class="pure-menu-item"><a href="/privacy_policy.html" class="pure-menu-link">Privacy Policy</a></li>
            <li class="pure-menu-item"><a href="/disclosure_statement.html" class="pure-menu-link">Disclosure Statement</a></li>
        </ul>
    </div>
</div>
    </div>



</div>


</body>

</html>
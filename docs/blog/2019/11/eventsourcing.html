<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">
    <title>Event Sourcing - An Introduction</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-"
          crossorigin="anonymous">

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
    <!--<![endif]-->


    <!--[if lte IE 8]>
    <link rel="stylesheet" href="css/layouts/blog-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/assets/blog.css">
    <!--<![endif]-->


<!--    <link rel="stylesheet"-->
<!--          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">-->
<!--    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>-->
<!--    <script>hljs.initHighlightingOnLoad();</script>-->

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-50141806-2', 'auto');
        ga('send', 'pageview');

    </script>

</head>


<body>

<div id="layout" class="pure-g">

    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <h1 class="brand-title">I don't byte</h1>
        <h2 class="brand-tagline">Oliver Jaun's Blog On Software Development</h2>

        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="pure-button" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="pure-button" href="/about.html">About</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <!-- A single blog post -->
        <section class="post">

            <header class="post-header">

                <h2 class="post-title">Event Sourcing - An Introduction</h2>

                <p class="post-meta">
                    By <a class="post-anchor" href="/about">Oliver Jaun</a>,
                    
                    <time datetime='2019-11-03'>Nov 3, 2019</time>
                    

                    


                    
                    <a class="post-category post-category-architecture" href="#">architecture</a>
                    
                    <a class="post-category post-category-design" href="#">design</a>
                    
                    <a class="post-category post-category-eventsourcing" href="#">eventsourcing</a>
                    
                </p>
            </header>

            <div class="post-description">
                <p>
                    <p>Does the world need yet another introduction on event sourcing? Well… My primary reason is be able to refer to it in my coming posts where I will dive more into specific topics that I encountered at work when started implementing an Event Sourced system at my company.</p>

<h1 id="a-definition">A definition</h1>

<p>So what’s the actual definition of Event Sourcing? The definition should be given by it’s inventor, right? So who’s the inventor?</p>

<p>Greg young at least “coined” the term CQRS (according to the <a href="https://dddeurope.com/2017/speakers/greg-young/">DDD Europe website</a>). I’m not sure whether he also coined the term “Event Sourcing”. At least he wrote an important “paper” on the topic <a href="https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf">which can be downloaded here</a>. But according to this paper the concept of using events as a storage mechanism is not new:</p>

<blockquote>
  <p>Before the general acceptance of the RDBMS as the center of the architecture many systems did not store current state. This was especially  true in high performance, mission critical, and/or highly secure systems. In fact if we look at the inner workings of a RDBMS we will find that most RDBMSs themselves not actually work by managing current state!</p>
</blockquote>

<p>So Event Sourcing is nothing new but at least it has gained some popularity in the last few years. A good definition of Event Sourcing comes from Martin Fowler:</p>

<blockquote>
  <p>The core idea of event sourcing is that whenever we make a change to the state of a system, we record that state change as an event, and we can confidently rebuild the system state by reprocessing the events at any time in the future. The event store becomes the principal source of truth, and the system state is purely derived from it. <a href="https://martinfowler.com/articles/201701-event-driven.html">Martin Fowler</a></p>
</blockquote>

<p>Although I think this definition is good I do not like <a href="https://martinfowler.com/eaaDev/EventSourcing.html">Fowler’s article on Event Sourcing</a> because I think his article can cause confusion and for some parts I do not agree with what he is saying. Also note that the article was written in 2005 and it has a disclaimer saying “As such this material is very much in draft form and I won’t be doing any corrections or updates until I’m able to find time to work on it again”.</p>

<h1 id="so-how-does-it-work">So how does it work?</h1>

<p>Actually it is quite simple: Instead of storing the current state to a database we only store everything that happens in our domain (the domain events) and derive the current state by going through all events.</p>

<p>First look at the traditional way with a database. The table to store persons could look as follows:</p>

<p><img src="/uml/aa5d9376674b31a66d8db3a4bf1920d1.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>

<p>In order to change the last name the old value is overwritten with the new value.</p>

<p>In an Event Source system there is a domain event “LastNameChanged” that contains the new  value for the last name.</p>

<p><img src="/uml/ea510df930143bd5848f64133721ef34.svg" alt="PlantUML SVG diagram" class="plantuml" /></p>

<p>So in order to know the current state of the given person we take the first <code class="highlighter-rouge">PersonCreated</code> and the apply the changes from the <code class="highlighter-rouge">LastNameChanged</code> event.</p>

<p>The advantage is obvious: We don’t loose information. In the traditional application that uses a database we loose forever the person’s last name before the last name has been changed. Of course there are solutions for this. A well-known library would be <a href="https://docs.jboss.org/envers/docs/">envers</a> that “enable easy auditing of persistent classes”.</p>

                </p>
            </div>
        </section>

        


<div id="disqus_thread"></div>
<script>

    var disqus_config = function () {
        this.page.url = "http://idontbyte.jaun.org/blog/2019/11/eventsourcing";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "/blog/2019/11/eventsourcing"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//idontbyte-jaun-org.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



        

<div class="footer">
    <div class="pure-menu pure-menu-horizontal">
        &copy; 2019 - Oliver Jaun
        <ul>
            <li class="pure-menu-item"><a href="/privacy_policy.html" class="pure-menu-link">Privacy Policy</a></li>
            <li class="pure-menu-item"><a href="/disclosure_statement.html" class="pure-menu-link">Disclosure Statement</a></li>
        </ul>
    </div>
</div>
    </div>



</div>


</body>

</html>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="616px" preserveAspectRatio="none" style="width:1059px;height:616px;" version="1.1" viewBox="0 0 1059 616" width="1059px" zoomAndPan="magnify"><defs><filter height="300%" id="fmvz0wamvg21q" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fmvz0wamvg21q)" height="177.8281" style="stroke: #000000; stroke-width: 2.0;" width="531" x="517.5" y="190.6953"/><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="859.5" y="266.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="286.0889">Account</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="27" y1="86.2969" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="27" x2="27" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="27" y1="489.7891" y2="528.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170.5" x2="170.5" y1="86.2969" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="170.5" x2="170.5" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170.5" x2="170.5" y1="489.7891" y2="528.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="384" y1="86.2969" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="384" x2="384" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="384" y1="489.7891" y2="528.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="584.5" x2="584.5" y1="86.2969" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="584.5" x2="584.5" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="584.5" x2="584.5" y1="489.7891" y2="528.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896.5" x2="896.5" y1="298.7422" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="896.5" x2="896.5" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896.5" x2="896.5" y1="489.7891" y2="528.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991.5" x2="991.5" y1="86.2969" y2="461.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="991.5" x2="991.5" y1="461.7891" y2="489.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="991.5" x2="991.5" y1="489.7891" y2="528.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FEFECE" filter="url(#fmvz0wamvg21q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="#FEFECE" filter="url(#fmvz0wamvg21q)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="540.917">User</text><ellipse cx="27" cy="554.2188" fill="#FEFECE" filter="url(#fmvz0wamvg21q)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,562.2188 L27,589.2188 M14,570.2188 L40,570.2188 M27,589.2188 L14,604.2188 M27,589.2188 L40,604.2188 " fill="#FEFECE" filter="url(#fmvz0wamvg21q)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="97.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="104.5" y="70.9951">Application Service</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="97.5" y="527.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="104.5" y="547.917">Application Service</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="308" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="315" y="70.9951">Command Gateway</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="308" y="527.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="315" y="547.917">Command Gateway</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="527.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="534.5" y="70.9951">Account Actor</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="527.5" y="527.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="534.5" y="547.917">Account Actor</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="859.5" y="527.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="547.917">Account</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="944.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="951.5" y="70.9951">EventStore</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="944.5" y="527.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="951.5" y="547.917">EventStore</text><polygon fill="#A80036" points="159,113.2969,169,117.2969,159,121.2969,163,117.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="165" y1="117.2969" y2="117.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="47" y="112.3638">withdraw("X", 42)</text><polygon fill="#A80036" points="372,142.4297,382,146.4297,372,150.4297,376,146.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="378" y1="146.4297" y2="146.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="178" y="141.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="191" y="141.4966">handle(cmd: WithdrawCmd)</text><polygon fill="#A80036" points="573,171.5625,583,175.5625,573,179.5625,577,175.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="579" y1="175.5625" y2="175.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="391" y="170.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="404" y="170.6294">send(cmd: WithdrawCmd)</text><rect fill="none" height="177.8281" style="stroke: #000000; stroke-width: 2.0;" width="531" x="517.5" y="190.6953"/><polygon fill="#EEEEEE" points="517.5,190.6953,581.5,190.6953,581.5,197.6953,571.5,207.6953,517.5,207.6953,517.5,190.6953" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="532.5" y="203.7622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="596.5" y="202.9058">[aggregate not loaded yet]</text><polygon fill="#A80036" points="979.5,224.8281,989.5,228.8281,979.5,232.8281,983.5,228.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="985.5" y1="228.8281" y2="228.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="592" y="223.895">4.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="619" y="223.895">loadEvents("X")</text><polygon fill="#A80036" points="596,253.9609,586,257.9609,596,261.9609,592,257.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="990.5" y1="257.9609" y2="257.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="602" y="253.0278">events: List&lt;Events&gt;</text><polygon fill="#A80036" points="847.5,283.0938,857.5,287.0938,847.5,291.0938,851.5,287.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="853.5" y1="287.0938" y2="287.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="592" y="282.1606">create()</text><rect fill="#FEFECE" filter="url(#fmvz0wamvg21q)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="859.5" y="266.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="286.0889">Account</text><polygon fill="#A80036" points="596,313.3906,586,317.3906,596,321.3906,592,317.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="317.3906" y2="317.3906"/><polygon fill="#A80036" points="885,342.3906,895,346.3906,885,350.3906,889,346.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="891" y1="346.3906" y2="346.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="592" y="341.4575">4.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="619" y="341.4575">apply(events)</text><polygon fill="#A80036" points="596,356.5234,586,360.5234,596,364.5234,592,360.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="360.5234" y2="360.5234"/><polygon fill="#A80036" points="885,392.5234,895,396.5234,885,400.5234,889,396.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="891" y1="396.5234" y2="396.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="592" y="391.5903">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="605" y="391.5903">handle(cmd: WithdrawCmd) : List&lt;Events&gt;</text><polygon fill="#A80036" points="596,406.6563,586,410.6563,596,414.6563,592,410.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="410.6563" y2="410.6563"/><polygon fill="#A80036" points="979.5,435.6563,989.5,439.6563,979.5,443.6563,983.5,439.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="985.5" y1="439.6563" y2="439.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="592" y="434.7231">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="605" y="434.7231">save(events)</text><polygon fill="#A80036" points="596,449.7891,586,453.7891,596,457.7891,592,453.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="990.5" y1="453.7891" y2="453.7891"/><polygon fill="#A80036" points="395,506.7891,385,510.7891,395,514.7891,391,510.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="584" y1="510.7891" y2="510.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="401" y="505.856">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="414" y="505.856">send(r: Response)</text><!--
@startuml

actor "User" as U
participant "Application Service" as AS
participant "Command Gateway" as CG
participant "Account Actor" as AC
participant "Account" as A
participant "EventStore" as ES

U -> AS: **1** withdraw("X", 42)
AS -> CG: **2** handle(cmd: WithdrawCmd)
CG -> AC: **3** send(cmd: WithdrawCmd)
alt aggregate not loaded yet
  AC -> ES: **4.1** loadEvents("X")
  AC <- - ES: events: List<Events>
  create A
  AC -> A: create()
  return
  AC -> A: **4.2** apply(events)
  return
end
AC -> A: **5** handle(cmd: WithdrawCmd) : List<Events>
AC <- - A:
AC -> ES: **6** save(events)
return
...
CG <- AC: **7** send(r: Response)

@enduml

PlantUML version 1.2017.15(Mon Jul 03 18:45:34 CEST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Linux
OS Version: 4.15.0-72-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="632px" preserveAspectRatio="none" style="width:1109px;height:632px;" version="1.1" viewBox="0 0 1109 632" width="1109px" zoomAndPan="magnify"><defs><filter height="300%" id="fgpco7forv9t5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fgpco7forv9t5)" height="194.125" style="stroke: #000000; stroke-width: 2.0;" width="603" x="495.5" y="190.6953"/><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="809.5" y="266.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="816.5" y="286.0889">&lt;&lt;Aggregate Root&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="302.3857">Account</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="27" y1="86.2969" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="27" x2="27" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="27" y1="506.0859" y2="545.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170.5" x2="170.5" y1="86.2969" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="170.5" x2="170.5" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="170.5" x2="170.5" y1="506.0859" y2="545.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="384" y1="86.2969" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="384" x2="384" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="384" y1="506.0859" y2="545.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="584.5" x2="584.5" y1="86.2969" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="584.5" x2="584.5" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="584.5" x2="584.5" y1="506.0859" y2="545.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896.5" x2="896.5" y1="306.8906" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="896.5" x2="896.5" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896.5" x2="896.5" y1="506.0859" y2="545.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1041.5" x2="1041.5" y1="86.2969" y2="478.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="1041.5" x2="1041.5" y1="478.0859" y2="506.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1041.5" x2="1041.5" y1="506.0859" y2="545.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="82.9951">User</text><ellipse cx="27" cy="13" fill="#FEFECE" filter="url(#fgpco7forv9t5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,21 L27,48 M14,29 L40,29 M27,48 L14,63 M27,48 L40,63 " fill="#FEFECE" filter="url(#fgpco7forv9t5)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="8" y="557.2139">User</text><ellipse cx="27" cy="570.5156" fill="#FEFECE" filter="url(#fgpco7forv9t5)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M27,578.5156 L27,605.5156 M14,586.5156 L40,586.5156 M27,605.5156 L14,620.5156 M27,605.5156 L40,620.5156 " fill="#FEFECE" filter="url(#fgpco7forv9t5)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="97.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="104.5" y="70.9951">Application Service</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="97.5" y="544.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="129" x="104.5" y="564.2139">Application Service</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="308" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="315" y="70.9951">Command Gateway</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="308" y="544.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="315" y="564.2139">Command Gateway</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="505.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="512.5" y="70.9951">&lt;&lt;Actor&gt;&gt;Account</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="505.5" y="544.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="512.5" y="564.2139">&lt;&lt;Actor&gt;&gt;Account</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="809.5" y="544.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="816.5" y="564.2139">&lt;&lt;Aggregate Root&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="580.5107">Account</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="994.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="1001.5" y="70.9951">EventStore</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="994.5" y="544.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="1001.5" y="564.2139">EventStore</text><polygon fill="#A80036" points="159,113.2969,169,117.2969,159,121.2969,163,117.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="27" x2="165" y1="117.2969" y2="117.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="34" y="112.3638">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="47" y="112.3638">withdraw("X", 42)</text><polygon fill="#A80036" points="372,142.4297,382,146.4297,372,150.4297,376,146.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="378" y1="146.4297" y2="146.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="178" y="141.4966">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="191" y="141.4966">handle(cmd: WithdrawCmd)</text><polygon fill="#A80036" points="573,171.5625,583,175.5625,573,179.5625,577,175.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="384" x2="579" y1="175.5625" y2="175.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="391" y="170.6294">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="404" y="170.6294">send(cmd: WithdrawCmd)</text><rect fill="none" height="194.125" style="stroke: #000000; stroke-width: 2.0;" width="603" x="495.5" y="190.6953"/><polygon fill="#EEEEEE" points="495.5,190.6953,559.5,190.6953,559.5,197.6953,549.5,207.6953,495.5,207.6953,495.5,190.6953" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="510.5" y="203.7622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="574.5" y="202.9058">[aggregate not loaded yet]</text><polygon fill="#A80036" points="1029.5,224.8281,1039.5,228.8281,1029.5,232.8281,1033.5,228.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="1035.5" y1="228.8281" y2="228.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="592" y="223.895">4.1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="619" y="223.895">loadEvents("X")</text><polygon fill="#A80036" points="596,253.9609,586,257.9609,596,261.9609,592,257.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="1040.5" y1="257.9609" y2="257.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="602" y="253.0278">events: List&lt;Events&gt;</text><polygon fill="#A80036" points="797.5,283.0938,807.5,287.0938,797.5,291.0938,801.5,287.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="803.5" y1="287.0938" y2="287.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="592" y="282.1606">create()</text><rect fill="#FEFECE" filter="url(#fgpco7forv9t5)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="809.5" y="266.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="816.5" y="286.0889">&lt;&lt;Aggregate Root&gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="866.5" y="302.3857">Account</text><polygon fill="#A80036" points="596,329.6875,586,333.6875,596,337.6875,592,333.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="333.6875" y2="333.6875"/><polygon fill="#A80036" points="885,358.6875,895,362.6875,885,366.6875,889,362.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="891" y1="362.6875" y2="362.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="592" y="357.7544">4.2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="619" y="357.7544">apply(events)</text><polygon fill="#A80036" points="596,372.8203,586,376.8203,596,380.8203,592,376.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="376.8203" y2="376.8203"/><polygon fill="#A80036" points="885,408.8203,895,412.8203,885,416.8203,889,412.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="891" y1="412.8203" y2="412.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="592" y="407.8872">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="605" y="407.8872">handle(cmd: WithdrawCmd) : List&lt;Events&gt;</text><polygon fill="#A80036" points="596,422.9531,586,426.9531,596,430.9531,592,426.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="896" y1="426.9531" y2="426.9531"/><polygon fill="#A80036" points="1029.5,451.9531,1039.5,455.9531,1029.5,459.9531,1033.5,455.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="1035.5" y1="455.9531" y2="455.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="592" y="451.02">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="605" y="451.02">save(events)</text><polygon fill="#A80036" points="596,466.0859,586,470.0859,596,474.0859,592,470.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="590" x2="1040.5" y1="470.0859" y2="470.0859"/><polygon fill="#A80036" points="395,523.0859,385,527.0859,395,531.0859,391,527.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="389" x2="584" y1="527.0859" y2="527.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="401" y="522.1528">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="414" y="522.1528">send(r: Response)</text><!--
@startuml

actor "User" as U
participant "Application Service" as AS
participant "Command Gateway" as CG
participant "<<Actor>>Account" as AC
participant "<<Aggregate Root>>\nAccount" as A
participant "EventStore" as ES

U -> AS: **1** withdraw("X", 42)
AS -> CG: **2** handle(cmd: WithdrawCmd)
CG -> AC: **3** send(cmd: WithdrawCmd)
alt aggregate not loaded yet
  AC -> ES: **4.1** loadEvents("X")
  AC <- - ES: events: List<Events>
  create A
  AC -> A: create()
  return
  AC -> A: **4.2** apply(events)
  return
end
AC -> A: **5** handle(cmd: WithdrawCmd) : List<Events>
AC <- - A:
AC -> ES: **6** save(events)
return
...
CG <- AC: **7** send(r: Response)

@enduml

PlantUML version 1.2017.15(Mon Jul 03 18:45:34 CEST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Linux
OS Version: 4.15.0-91-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>